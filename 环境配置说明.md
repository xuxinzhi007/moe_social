# 环境配置说明

## 📋 环境地址

### 开发环境（本地）
- **地址**: `http://localhost:8888`
- **用途**: 本地开发调试

### 生产环境（cpolar隧道）
- **地址**: `http://a3b4e47.r3.cpolar.top`
- **用途**: 生产环境部署

## 🔧 如何切换环境

### 方法1：修改代码中的环境标志（推荐）

在 `lib/services/api_service.dart` 文件中，找到：

```dart
static const bool _isProduction = false; // 修改这里切换环境
```

- **开发环境**: 设置为 `false`
- **生产环境**: 设置为 `true`

### 方法2：使用环境变量（高级）

可以通过编译时参数传递：

```bash
# 开发环境
flutter run

# 生产环境
flutter run --dart-define=ENV=production

# 构建生产版本
flutter build apk --release --dart-define=ENV=production
```

然后在代码中：
```dart
static const String env = String.fromEnvironment('ENV', defaultValue: 'development');
static const bool _isProduction = env == 'production';
```

## 📱 各平台配置

### Web平台
- **开发**: `http://localhost:8888`
- **生产**: `http://a3b4e47.r3.cpolar.top`

### Android模拟器
- **开发**: `http://10.0.2.2:8888`
- **生产**: `http://a3b4e47.r3.cpolar.top`

### Android真机
- **开发**: `http://你的电脑IP:8888`（需要修改代码）
- **生产**: `http://a3b4e47.r3.cpolar.top`

### iOS模拟器
- **开发**: `http://localhost:8888`
- **生产**: `http://a3b4e47.r3.cpolar.top`

### iOS真机
- **开发**: `http://你的电脑IP:8888`（需要修改代码）
- **生产**: `http://a3b4e47.r3.cpolar.top`

## ✅ 后端配置

**后端无需修改**，因为：
- 后端只配置端口和主机（`0.0.0.0:8888`）
- 后端没有硬编码的API地址
- cpolar会自动将公网地址映射到本地地址

## 🚀 部署流程

### 开发环境
1. 确保后端服务运行在 `localhost:8888`
2. 设置 `_isProduction = false`
3. 运行应用

### 生产环境
1. 确保cpolar隧道正常运行
2. 确保后端服务运行在 `localhost:8888`
3. 设置 `_isProduction = true`
4. 构建并发布应用

## 📝 注意事项

1. **cpolar隧道地址可能会变化**
   - 免费版cpolar的地址可能会变化
   - 如果地址变化，需要更新 `_productionUrl`

2. **HTTPS支持**
   - 如果需要HTTPS，可以使用：`https://a3b4e47.r3.cpolar.top`
   - 需要修改 `_productionUrl` 为HTTPS地址

3. **CORS配置**
   - 后端已配置允许所有来源的CORS
   - 生产环境建议限制允许的来源

4. **安全性**
   - 生产环境建议使用HTTPS
   - 建议添加API密钥或Token验证

## 🔍 验证配置

切换环境后，可以通过以下方式验证：

1. **查看日志**
   ```dart
   print('API Base URL: ${ApiService.baseUrl}');
   ```

2. **测试连接**
   - 尝试登录或调用API
   - 查看网络请求的URL是否正确

3. **检查错误**
   - 如果连接失败，检查地址是否正确
   - 检查后端服务是否正常运行


