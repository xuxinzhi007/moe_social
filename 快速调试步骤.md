# 快速调试步骤

## 🚀 在模拟器上运行（推荐）

### 步骤1：启动Android模拟器

```bash
# 查看可用的模拟器
flutter emulators

# 启动模拟器（选择一个）
flutter emulators --launch <emulator_id>

# 或者使用Android Studio的AVD Manager
# Tools > Device Manager > Create Device
```

### 步骤2：确认设备已连接

```bash
flutter devices
```

应该看到类似：
```
2 connected devices:
sdk gphone64 arm64 (mobile) • emulator-5554 • android-arm64  • Android 13 (API 33)
Chrome (web)                • chrome         • web-javascript • Google Chrome
```

### 步骤3：运行应用

```bash
flutter run
```

应用会自动安装到模拟器并启动。

### 步骤4：查看日志

在另一个终端窗口运行：
```bash
flutter logs
```

或者实时查看：
```bash
flutter run --verbose
```

## 🔍 查看错误日志

### 方法1：Flutter日志（最简单）

```bash
flutter logs
```

### 方法2：adb logcat（更详细）

```bash
# 查看所有日志
adb logcat

# 只查看错误
adb logcat *:E

# 只查看Flutter相关
adb logcat | grep flutter

# 清除日志后重新运行
adb logcat -c
flutter run
```

### 方法3：保存日志到文件

```bash
adb logcat > app_log.txt
# 运行应用，然后按Ctrl+C停止
# 查看app_log.txt文件
```

## 📱 真机调试

### 步骤1：启用USB调试

1. 打开手机的"开发者选项"
2. 启用"USB调试"
3. 连接手机到电脑

### 步骤2：确认设备连接

```bash
adb devices
```

应该看到你的设备。

### 步骤3：修改API地址

在 `lib/services/api_service.dart` 中，找到第46-50行：

```dart
} else if (Platform.isAndroid) {
  // 真机测试时需要修改为电脑的实际IP地址
  return 'http://192.168.1.16:8888'; // 替换为你的电脑IP
  // return 'http://10.0.2.2:8888'; // Android模拟器使用这个
}
```

**获取电脑IP地址：**
```bash
# Windows
ipconfig

# Mac/Linux
ifconfig
```

### 步骤4：运行应用

```bash
flutter run
```

## 🐛 常见问题排查

### 问题1：应用启动就闪退

**查看日志：**
```bash
flutter logs
```

**检查：**
1. 是否有网络权限错误
2. 是否有空指针异常
3. API地址是否正确

### 问题2：无法连接到服务器

**检查：**
1. 后端服务是否运行：`curl http://localhost:8888/api/user/login`
2. API地址是否正确
3. 防火墙是否阻止连接

### 问题3：模拟器无法连接

**确认：**
- 模拟器使用：`http://10.0.2.2:8888`
- 真机使用：`http://你的电脑IP:8888`

## 💡 调试技巧

### 1. 添加调试输出

代码中已经添加了启动日志，运行应用时会看到：
```
🚀 App starting...
📱 Platform: android
🌐 API Base URL: http://10.0.2.2:8888
```

### 2. 使用生产环境地址测试

如果本地连接有问题，可以临时使用生产环境：

在 `lib/services/api_service.dart` 第27行：
```dart
static const bool _isProduction = true; // 临时使用生产环境
```

### 3. 逐步测试

1. 先测试登录页面是否能显示
2. 再测试登录功能
3. 最后测试其他功能

## 📋 检查清单

- [ ] 模拟器已启动
- [ ] 设备已连接（`flutter devices`）
- [ ] 后端服务正在运行
- [ ] API地址配置正确
- [ ] 网络权限已添加
- [ ] 已查看日志（`flutter logs`）

## 🆘 如果还是闪退

1. **查看完整日志**
   ```bash
   adb logcat > crash_log.txt
   flutter run
   # 应用闪退后，查看crash_log.txt
   ```

2. **检查具体错误**
   - 查找 "FATAL EXCEPTION"
   - 查找 "Error"
   - 查找 "Exception"

3. **发送错误信息**
   - 复制完整的错误堆栈
   - 包含错误发生的位置


