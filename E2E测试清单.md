## E2E 测试清单（手工可复现）

目标：验证“前端登录 → 发帖 → 获取实时通知 → WebSocket 消息”的完整链路可用，并能定位问题属于 **HTTP API / WS / 鉴权 / 数据一致性** 哪一层。

### 0. 环境准备
- 后端 API：`backend/api` 已启动（默认 `:8888`）
- 后端 RPC：`backend/rpc` 已启动（默认 `:8080`），并确保 API 的 `SuperRpc` 可连通
- 前端：运行 App（真机/模拟器/Web 均可）

### 1. 登录（HTTP）
- **操作**：用已注册账号登录
- **期望**：
  - 登录成功提示出现（全局消息条）
  - 进入首页
  - App 自动启动 WS：presence/chat（可看后端日志/前端 debugPrint）

### 2. 发帖（HTTP + 上传）
- **操作**：进入“发布新动态”，输入内容，选择 0~N 张图片（本地或云端图库），点击“发布”
- **期望**：
  - 发布按钮进入 loading 状态（按钮内转圈）
  - 发布成功提示出现
  - 返回首页后列表刷新能看到新帖

### 3. 通知（HTTP + WS 相关）
- **操作**：
  - 在另一台设备/另一个账号上给你发私信（或触发通知的行为）
  - 返回通知中心查看未读数变化
- **期望**：
  - 通知未读数变化（HTTP 轮询/或 WS 推送到位）
  - 通知列表可见对应记录

### 4. WebSocket - 在线状态（WS）
- **操作**：打开好友/聊天相关页面，观察在线标记变化
- **期望**：
  - `/ws/presence` 建连成功后会收到 `presence_snapshot`
  - 在线状态变化能被前端反映

### 5. WebSocket - 私信消息（WS）
- **操作**：两端互发消息
- **期望**：
  - `/ws/chat` 建连成功
  - 接收端能实时收到消息（不需要手动刷新）

### 6. WebSocket - 远程控制（WS）
- **操作**：进入设置页的远程设备相关功能，触发一次远程命令（如有）
- **期望**：
  - `/ws/remote` 建连成功并能收发数据

### 7. 失败定位建议（遇到问题时）
- **登录失败**：优先看 HTTP 响应码/错误信息（token 是否下发）
- **HTTP 正常但 WS 401**：看 WS handler 是否收到 `Authorization: Bearer ...`；检查 token 是否包含 `Bearer ` 前缀重复
- **WS 建连但不推送**：看后端是否进入读循环、是否有心跳；检查客户端是否发 `ping`
- **通知不刷新**：区分 “WS 推送” vs “HTTP 轮询”，看通知中心接口返回是否正确

