# 头像框与奖池配置操作流程

本流程用于说明：**如何新增一个头像框，并让它出现在奖池预览页面中且可以被抽到**。

---

## 一、准备头像框资源文件

- 资源路径：`assets/frames/`
- Lottie 动画示例：`assets/frames/Avatar Frame.json`

操作步骤：
- 将新的头像框动画文件（如 `star_trail.json`）放入 `assets/frames/` 目录。
- `pubspec.yaml` 中已经包含：
  - `assets/frames/`
  - 因此只要放在该目录下即可，无需额外修改 `pubspec.yaml`。

---

## 二、在 DynamicAvatar 中注册新的头像框 ID

文件位置：
- `lib/widgets/dynamic_avatar.dart`

关键点：
- 头像框是通过 `frameId` 来区分不同特效的。
- 当前 Lottie 头像框示例使用了：
  - `frame_lottie_test`
  - `frame_lottie_01`
  - 对应资源：`assets/frames/Avatar Frame.json`

操作步骤（示例）：
- 在 `_buildFrameEffect(String frameId)` 中新增一个分支，例如：
  - 当 `frameId == 'frame_lottie_star_trail'` 时，加载 `assets/frames/star_trail.json`。
- 保证：
  - `frameId` 命名清晰，例如：`frame_lottie_xxx`。
  - 每个新的头像框 `frameId` 在此函数中都有对应的显示实现。

---

## 三、在奖池中新增对应的虚拟物品

文件位置：
- `lib/models/virtual_item.dart`

关键点：
- 抽奖的奖池来源是 `VirtualItem.mockItems`。
- 抽奖逻辑使用的是这一列表（而不是直接扫描 `assets/frames` 目录）。

当前与 Lottie 头像框相关的配置示例：
- `id: 'frame_lottie_test'`
- `type: ItemType.avatarFrame`
- `rarity: ItemRarity.ssr`

操作步骤（示例）：
- 在 `VirtualItem.mockItems` 列表中新增一个 `VirtualItem`：
  - `id`：与第二步中在 `DynamicAvatar` 注册的 `frameId` 保持一致，例如：`frame_lottie_star_trail`。
  - `name`：头像框显示名称。
  - `description`：简单说明。
  - `type`：填写 `ItemType.avatarFrame`。
  - `rarity`：根据需要选择 `ItemRarity.n / r / sr / ssr`。

重要说明：
- **只有添加到 `VirtualItem.mockItems` 里的条目，才会：**
  - 显示在“奖池预览”页面中。
  - 被抽奖逻辑纳入概率计算，有机会被抽到。

---

## 四、奖池预览与概率说明的自动更新机制

文件位置（主要逻辑）：
- 奖池预览弹窗：
  - `lib/gacha_page.dart`
  - 函数：`_showGachaPoolDialog()` 与 `_buildPoolItemCard(...)`
- 概率说明弹窗：
  - `lib/gacha_page.dart`
  - 函数：`_showProbabilityDialog()`

行为说明：
- “奖池预览”页面：
  - 直接遍历 `VirtualItem.mockItems`。
  - 按每个物品的 `type` 和 `rarity` 展示卡片。
  - 头像框会使用 `DynamicAvatar` 按 `frameId` 渲染对应特效。
- “概率说明”页面：
  - 按 `ItemRarity` 将 `VirtualItem.mockItems` 分组。
  - 自动列出每个稀有度下的物品名称（SSR/SR/R/N）。

因此：
- 只要在第三步中正确新增 `VirtualItem`，这两处展示会自动更新，无需额外手动修改。

---

## 五、验证新增头像框是否配置成功

建议的自测步骤：

1. 启动应用或热重载。
2. 打开“心情扭蛋机”页面。
3. 点击顶部“当前奖品池”按钮：
   - 在弹出的“奖池预览”卡片列表中，确认看到新头像框卡片。
4. 在“奖池预览”弹窗右上角点击感叹号图标：
   - 确认在相应稀有度（SSR/SR/R/N）的文字说明中，出现新头像框的名称。
5. 进行多次抽奖：
   - 抽到该头像框时，结果弹窗和背包页面会使用对应的动态头像框特效展示。

如需进行更充分测试，可以在开发环境中临时提高对应稀有度的概率（例如将 SSR 概率调高），方便快速验证新头像框是否可以被正常抽到。完成验证后再将概率还原。

