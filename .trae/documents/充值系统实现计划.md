# 充值系统实现计划

## 项目现状分析

### 已实现功能
- 用户认证（登录、注册）
- 帖子管理（创建、获取、点赞）
- 评论管理（创建、点赞）
- 用户信息管理
- VIP系统（套餐、订单、历史记录）

### 缺失功能
- 钱包系统（用户余额）
- 充值功能
- 交易记录

## 实现方案

### 1. 数据库模型修改

#### 1.1 修改用户模型（添加钱包字段）
- 在 `User` 模型中添加 `Balance` 字段（double类型，默认0）
- 用于存储用户的钱包余额

#### 1.2 创建交易记录模型
- 创建 `Transaction` 模型
- 包含字段：ID、UserID、Amount、Type（充值/消费）、Status、Description、CreatedAt

### 2. 后端API实现

#### 2.1 钱包相关API
- `GET /api/user/:user_id/wallet` - 获取用户钱包余额
- `POST /api/user/:user_id/wallet/recharge` - 充值接口

#### 2.2 交易记录API
- `GET /api/user/:user_id/transactions` - 获取用户交易记录
- `GET /api/user/:user_id/transactions/:transaction_id` - 获取单个交易记录

### 3. 前端实现

#### 3.1 充值页面
- 创建 `recharge_page.dart`
- 实现充值金额输入表单
- 模拟支付流程
- 显示充值成功结果

#### 3.2 钱包页面
- 创建 `wallet_page.dart`
- 显示用户当前余额
- 显示最近交易记录
- 提供充值入口

#### 3.3 个人资料页面修改
- 添加钱包余额显示
- 添加钱包入口

### 4. 实现步骤

1. **修改数据库模型**
   - 更新 `backend/model/user.go` 添加 Balance 字段
   - 创建 `backend/model/transaction.go` 模型

2. **实现后端逻辑**
   - 创建交易相关的RPC服务
   - 创建API处理程序
   - 实现充值逻辑

3. **更新前端API服务**
   - 在 `lib/services/api_service.dart` 中添加钱包和交易相关方法

4. **实现前端页面**
   - 创建充值页面
   - 创建钱包页面
   - 修改个人资料页面

5. **测试和验证**
   - 测试充值功能
   - 测试交易记录查询
   - 验证余额更新

## 技术要点

- 采用模拟支付方式，不调用真实支付接口
- 交易记录需要详细记录充值金额、时间、状态
- 钱包余额需要实时更新
- 前端页面需要友好的用户体验

## 预期效果

- 用户可以在APP内进行充值
- 用户可以查看钱包余额和交易记录
- 充值过程流畅，用户体验良好
- 数据安全可靠，交易记录完整

## 后续优化方向

- 添加消费功能（如购买虚拟商品）
- 实现真实支付接口集成
- 添加提现功能
- 实现交易统计和分析