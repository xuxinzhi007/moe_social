# å‰ç«¯æ•°æ®æ¨¡å‹ä¿®å¤è¯´æ˜

## ğŸ“‹ ä¿®å¤æ¦‚è¿°

æ ¹æ®åç«¯APIå®šä¹‰ï¼Œå·²å°†æ‰€æœ‰å‰ç«¯æ•°æ®æ¨¡å‹ä¿®å¤ä¸ºä¸åç«¯ä¸€è‡´çš„æ•°æ®æ ¼å¼ã€‚

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. Useræ¨¡å‹ (`lib/models/user.dart`)

#### ä¿®å¤å†…å®¹ï¼š
- âœ… IDç±»å‹ï¼šä» `int` æ”¹ä¸º `String`
- âœ… æ·»åŠ  `avatar` å­—æ®µï¼ˆå¤´åƒURLï¼‰
- âœ… æ·»åŠ  `vipExpiresAt` å­—æ®µï¼ˆVIPè¿‡æœŸæ—¶é—´ï¼Œå­—ç¬¦ä¸²æ ¼å¼ï¼‰
- âœ… æ·»åŠ  `autoRenew` å­—æ®µï¼ˆè‡ªåŠ¨ç»­è´¹æ ‡å¿—ï¼‰
- âœ… æ—¶é—´å­—æ®µï¼š`createdAt` å’Œ `updatedAt` æ”¹ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼ˆä¸åç«¯ä¸€è‡´ï¼‰
- âœ… ç§»é™¤ï¼š`vipStartAt` å’Œ `vipEndAt`ï¼ˆåç«¯ä½¿ç”¨ `vip_expires_at`ï¼‰

#### æ–°å¢è¾…åŠ©æ–¹æ³•ï¼š
- `createdAtDateTime`: è·å–åˆ›å»ºæ—¶é—´çš„DateTimeå¯¹è±¡ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
- `updatedAtDateTime`: è·å–æ›´æ–°æ—¶é—´çš„DateTimeå¯¹è±¡ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
- `vipExpiresAtDateTime`: è·å–VIPè¿‡æœŸæ—¶é—´çš„DateTimeå¯¹è±¡ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰

### 2. VipPlanæ¨¡å‹ (`lib/models/vip_plan.dart`)

#### ä¿®å¤å†…å®¹ï¼š
- âœ… IDç±»å‹ï¼šä» `int` æ”¹ä¸º `String`
- âœ… å­—æ®µé‡å‘½åï¼š`duration` â†’ `durationDays`
- âœ… å­—æ®µé‡å‘½åï¼š`features` â†’ `description`
- âœ… æ—¶é—´å­—æ®µï¼š`createdAt` å’Œ `updatedAt` æ”¹ä¸ºå­—ç¬¦ä¸²æ ¼å¼

#### æ–°å¢è¾…åŠ©æ–¹æ³•ï¼š
- `createdAtDateTime`: è·å–åˆ›å»ºæ—¶é—´çš„DateTimeå¯¹è±¡
- `updatedAtDateTime`: è·å–æ›´æ–°æ—¶é—´çš„DateTimeå¯¹è±¡

### 3. VipOrderæ¨¡å‹ (`lib/models/vip_order.dart`)

#### ä¿®å¤å†…å®¹ï¼š
- âœ… IDç±»å‹ï¼šä» `int` æ”¹ä¸º `String`
- âœ… `userId` å’Œ `planId` ç±»å‹ï¼šä» `int` æ”¹ä¸º `String`
- âœ… æ·»åŠ  `planName` å­—æ®µ
- âœ… ç§»é™¤ `orderNo` å’Œ `payMethod` å­—æ®µï¼ˆåç«¯æœªå®šä¹‰ï¼‰
- âœ… `paidAt` æ”¹ä¸ºå¯é€‰å­—æ®µï¼ˆå¯èƒ½ä¸ºç©ºï¼‰
- âœ… æ—¶é—´å­—æ®µæ”¹ä¸ºå­—ç¬¦ä¸²æ ¼å¼

#### æ–°å¢è¾…åŠ©æ–¹æ³•ï¼š
- `createdAtDateTime`: è·å–åˆ›å»ºæ—¶é—´çš„DateTimeå¯¹è±¡
- `paidAtDateTime`: è·å–æ”¯ä»˜æ—¶é—´çš„DateTimeå¯¹è±¡

### 4. VipRecordæ¨¡å‹ (`lib/models/vip_record.dart`)

#### ä¿®å¤å†…å®¹ï¼š
- âœ… IDç±»å‹ï¼šä» `int` æ”¹ä¸º `String`
- âœ… `userId` å’Œ `planId` ç±»å‹ï¼šä» `int` æ”¹ä¸º `String`
- âœ… æ·»åŠ  `planName` å­—æ®µ
- âœ… æ·»åŠ  `status` å­—æ®µï¼ˆåç«¯å®šä¹‰ï¼‰
- âœ… ç§»é™¤ `isActive` å­—æ®µï¼ˆæ”¹ä¸ºé€šè¿‡ `status` å’Œ `endAt` è®¡ç®—ï¼‰
- âœ… æ—¶é—´å­—æ®µæ”¹ä¸ºå­—ç¬¦ä¸²æ ¼å¼

#### æ–°å¢è¾…åŠ©æ–¹æ³•ï¼š
- `startAtDateTime`: è·å–å¼€å§‹æ—¶é—´çš„DateTimeå¯¹è±¡
- `endAtDateTime`: è·å–ç»“æŸæ—¶é—´çš„DateTimeå¯¹è±¡
- `createdAtDateTime`: è·å–åˆ›å»ºæ—¶é—´çš„DateTimeå¯¹è±¡
- `isActive`: è®¡ç®—å±æ€§ï¼Œæ ¹æ®çŠ¶æ€å’Œç»“æŸæ—¶é—´åˆ¤æ–­æ˜¯å¦æ´»è·ƒ

### 5. ApiService (`lib/services/api_service.dart`)

#### æ–°å¢ç”¨æˆ·ä¿¡æ¯ç®¡ç†APIï¼š
- âœ… `getUserInfo(String userId)`: è·å–ç”¨æˆ·ä¿¡æ¯
- âœ… `updateUserInfo(String userId, {...})`: æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- âœ… `updateUserPassword(String userId, String oldPassword, String newPassword)`: æ›´æ–°å¯†ç 
- âœ… `deleteUser(String userId)`: åˆ é™¤ç”¨æˆ·
- âœ… `getUsers({int page, int pageSize})`: è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
- âœ… `getUserCount()`: è·å–ç”¨æˆ·æ•°é‡

#### æ–°å¢VIPç›¸å…³APIï¼š
- âœ… `getUserVipStatus(String userId)`: è·å–ç”¨æˆ·VIPçŠ¶æ€
- âœ… `checkUserVip(String userId)`: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºVIP
- âœ… `createVipOrder(String userId, String planId)`: åˆ›å»ºVIPè®¢å•
- âœ… `getVipOrders(String userId, {...})`: è·å–VIPè®¢å•åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
- âœ… `getVipHistory(String userId, {...})`: è·å–VIPå†å²è®°å½•ï¼ˆåˆ†é¡µï¼‰
- âœ… `getUserActiveVipRecord(String userId)`: è·å–æ´»è·ƒVIPè®°å½•
- âœ… `updateAutoRenew(String userId, bool autoRenew)`: æ›´æ–°è‡ªåŠ¨ç»­è´¹
- âœ… `syncUserVipStatus(String userId)`: åŒæ­¥VIPçŠ¶æ€

#### æ–°å¢VIPå¥—é¤APIï¼š
- âœ… `getVipPlans()`: è·å–VIPå¥—é¤åˆ—è¡¨
- âœ… `getVipPlan(String planId)`: è·å–VIPå¥—é¤è¯¦æƒ…
- âœ… `createVipPlan({...})`: åˆ›å»ºVIPå¥—é¤ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰

### 6. AuthService (`lib/auth_service.dart`)

#### ä¿®å¤å†…å®¹ï¼š
- âœ… æ›´æ–° `login` æ–¹æ³•ï¼Œæ­£ç¡®å¤„ç†åç«¯è¿”å›çš„æ•°æ®æ ¼å¼
- âœ… `_currentUser` ç°åœ¨å­˜å‚¨çš„æ˜¯ `String` ç±»å‹çš„ç”¨æˆ·ID

### 7. ProfilePage (`lib/profile_page.dart`)

#### æ–°å¢åŠŸèƒ½ï¼š
- âœ… ä»APIåŠ è½½ç”¨æˆ·ä¿¡æ¯
- âœ… æ˜¾ç¤ºç”¨æˆ·å¤´åƒã€ç”¨æˆ·åã€é‚®ç®±
- âœ… æ˜¾ç¤ºVIPçŠ¶æ€å’ŒVIPåˆ°æœŸæ—¶é—´
- âœ… ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½
- âœ… é€€å‡ºç™»å½•æ—¶è°ƒç”¨ `AuthService.logout()`

### 8. SettingsPage (`lib/settings_page.dart`)

#### æ–°å¢åŠŸèƒ½ï¼š
- âœ… ä¿®æ”¹å¯†ç å¯¹è¯æ¡†
- âœ… å¯†ç éªŒè¯ï¼ˆé•¿åº¦ã€ç¡®è®¤å¯†ç ï¼‰
- âœ… è°ƒç”¨ `ApiService.updateUserPassword` API

## ğŸ“ æ•°æ®æ ¼å¼è¯´æ˜

### åç«¯è¿”å›çš„æ—¶é—´æ ¼å¼
æ‰€æœ‰æ—¶é—´å­—æ®µåç«¯è¿”å›çš„æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼ˆISO 8601æ ¼å¼ï¼‰ï¼Œä¾‹å¦‚ï¼š
- `"2024-01-01 12:00:00"` æˆ–
- `"2024-01-01T12:00:00Z"`

å‰ç«¯æ¨¡å‹æä¾›äº†è¾…åŠ©æ–¹æ³•ï¼ˆå¦‚ `createdAtDateTime`ï¼‰æ¥è½¬æ¢ä¸º `DateTime` å¯¹è±¡ï¼Œæ–¹ä¾¿åœ¨UIä¸­æ˜¾ç¤ºã€‚

### IDç±»å‹ç»Ÿä¸€
æ‰€æœ‰IDå­—æ®µç»Ÿä¸€ä½¿ç”¨ `String` ç±»å‹ï¼Œä¸åç«¯ä¿æŒä¸€è‡´ã€‚

### å­—æ®µå‘½å
- åç«¯ä½¿ç”¨ä¸‹åˆ’çº¿å‘½åï¼ˆsnake_caseï¼‰ï¼š`created_at`, `is_vip`, `vip_expires_at`
- å‰ç«¯æ¨¡å‹åœ¨ `fromJson` å’Œ `toJson` æ–¹æ³•ä¸­å¤„ç†å‘½åè½¬æ¢

## âš ï¸ æ³¨æ„äº‹é¡¹

### Postå’ŒCommentæ¨¡å‹
- Postå’ŒCommentæ¨¡å‹ç›®å‰ä¿æŒåŸæ ·ï¼Œå› ä¸ºåç«¯å°šæœªå®ç°è¿™äº›API
- ç­‰åç«¯å®ç°åï¼Œå¯èƒ½éœ€è¦æ ¹æ®å®é™…è¿”å›æ ¼å¼è¿›è¡Œè°ƒæ•´

### é”™è¯¯å¤„ç†
- æ‰€æœ‰APIè°ƒç”¨éƒ½åŒ…å«é”™è¯¯å¤„ç†
- ä½¿ç”¨ `ApiException` ç±»ç»Ÿä¸€å¤„ç†é”™è¯¯
- UIå±‚ä¼šæ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **æµ‹è¯•APIå¯¹æ¥**ï¼šæµ‹è¯•æ‰€æœ‰æ–°å¢çš„APIè°ƒç”¨æ˜¯å¦æ­£å¸¸å·¥ä½œ
2. **å®ç°VIPè´­ä¹°é¡µé¢**ï¼šä½¿ç”¨æ–°å¢çš„VIPç›¸å…³APIå®ç°VIPè´­ä¹°æµç¨‹
3. **å®ç°ç”¨æˆ·ä¿¡æ¯ç¼–è¾‘é¡µé¢**ï¼šä½¿ç”¨ `updateUserInfo` APIå®ç°ç”¨æˆ·ä¿¡æ¯ç¼–è¾‘åŠŸèƒ½
4. **ç­‰å¾…åç«¯å®ç°å¸–å­ç³»ç»Ÿ**ï¼šç­‰åç«¯å®ç°å¸–å­ç›¸å…³APIåï¼Œå†è°ƒæ•´Postå’ŒCommentæ¨¡å‹

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `lib/models/user.dart` - Useræ¨¡å‹
- `lib/models/vip_plan.dart` - VipPlanæ¨¡å‹
- `lib/models/vip_order.dart` - VipOrderæ¨¡å‹
- `lib/models/vip_record.dart` - VipRecordæ¨¡å‹
- `lib/services/api_service.dart` - APIæœåŠ¡
- `lib/auth_service.dart` - è®¤è¯æœåŠ¡
- `lib/profile_page.dart` - ä¸ªäººä¸­å¿ƒé¡µé¢
- `lib/settings_page.dart` - è®¾ç½®é¡µé¢

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2024å¹´
**ä¿®å¤èŒƒå›´**: æ‰€æœ‰æ•°æ®æ¨¡å‹å’ŒAPIè°ƒç”¨å·²ä¸åç«¯å¯¹é½

