# 调试闪退问题指南

## 🔍 查看错误日志

### 方法1：使用Flutter命令查看日志（推荐）

```bash
# 连接设备后运行
flutter logs

# 或者只查看错误
flutter logs | grep -i error
```

### 方法2：使用adb查看Android日志

```bash
# 查看所有日志
adb logcat

# 只查看Flutter相关日志
adb logcat | grep flutter

# 只查看错误和异常
adb logcat *:E flutter:*

# 清除日志后重新运行
adb logcat -c
flutter run
```

### 方法3：在Android Studio中查看

1. 打开Android Studio
2. 连接设备
3. 点击底部的 "Logcat" 标签
4. 过滤 "flutter" 或 "error"

## 🐛 常见闪退原因

### 1. 网络连接问题
- **症状**: 应用启动后立即闪退
- **原因**: 无法连接到API服务器
- **解决**: 
  - 检查API地址是否正确
  - 检查网络权限是否已添加
  - 检查后端服务是否运行

### 2. 空指针异常
- **症状**: 访问某个页面时闪退
- **原因**: 访问了null对象
- **解决**: 查看日志中的具体错误位置

### 3. 平台兼容性问题
- **症状**: 某些功能在真机上闪退，模拟器正常
- **原因**: 使用了不兼容的API
- **解决**: 检查Platform.isAndroid等判断

### 4. 资源加载失败
- **症状**: 加载图片或资源时闪退
- **原因**: 资源路径错误或资源不存在
- **解决**: 检查资源路径和文件是否存在

## 🧪 在模拟器上测试

### 启动Android模拟器

```bash
# 列出可用的模拟器
flutter emulators

# 启动模拟器
flutter emulators --launch <emulator_id>

# 或者使用Android Studio的AVD Manager创建并启动
```

### 在模拟器上运行

```bash
# 确保模拟器已启动
flutter devices

# 运行应用
flutter run

# 或者指定设备
flutter run -d <device_id>
```

### 模拟器API地址配置

Android模拟器需要使用特殊地址访问本地服务：
- **本地API**: `http://10.0.2.2:8888`
- 已自动配置在代码中

## 🔧 已添加的调试功能

### 1. 启动日志
应用启动时会输出：
- 🚀 App starting...
- 📱 Platform: android/ios/web
- 🌐 API Base URL: http://...

### 2. 错误捕获
- Flutter框架错误
- 异步错误
- 未捕获的错误

### 3. 详细错误信息
所有错误都会输出到控制台，包含：
- 错误类型
- 错误消息
- 堆栈跟踪

## 📝 调试步骤

### 步骤1：查看启动日志

运行应用后，立即查看日志：
```bash
flutter logs
```

查找：
- `🚀 App starting...` - 确认应用已启动
- `🌐 API Base URL: ...` - 确认API地址正确
- 任何错误信息

### 步骤2：检查API连接

如果看到网络错误：
1. 确认后端服务正在运行
2. 确认API地址正确
3. 在浏览器中测试API地址是否可访问

### 步骤3：逐步测试

1. **先测试登录页面**
   - 如果登录页面能显示，说明基础功能正常
   - 如果登录页面就闪退，检查登录页面的代码

2. **测试API调用**
   - 尝试登录
   - 查看网络请求是否成功
   - 查看响应数据格式是否正确

3. **测试其他页面**
   - 逐个测试各个页面
   - 找出具体哪个页面导致闪退

## 🛠️ 临时调试方案

### 方案1：禁用网络请求

如果怀疑是网络问题，可以临时注释掉API调用：

```dart
// 临时禁用API调用
static Future<Map<String, dynamic>> login(String email, String password) async {
  // return await ApiService.login(email, password);
  return {'success': true}; // 临时返回成功
}
```

### 方案2：添加try-catch

在可能出错的地方添加try-catch：

```dart
try {
  // 你的代码
} catch (e, stack) {
  print('Error: $e');
  print('Stack: $stack');
  // 显示错误提示而不是闪退
}
```

### 方案3：使用生产环境地址

如果本地连接有问题，可以临时使用生产环境：

```dart
static const bool _isProduction = true; // 临时使用生产环境
```

## 📱 模拟器测试步骤

1. **启动模拟器**
   ```bash
   flutter emulators --launch <emulator_id>
   ```

2. **等待模拟器完全启动**

3. **运行应用**
   ```bash
   flutter run
   ```

4. **查看日志**
   ```bash
   flutter logs
   ```

5. **测试功能**
   - 尝试登录
   - 测试各个页面
   - 查看是否有错误

## ⚠️ 如果仍然闪退

1. **查看完整日志**
   ```bash
   adb logcat > log.txt
   # 运行应用
   # 停止日志
   # 查看log.txt文件
   ```

2. **检查AndroidManifest.xml**
   - 确认权限已添加
   - 确认usesCleartextTraffic已设置

3. **检查API地址**
   - 模拟器：`http://10.0.2.2:8888`
   - 真机：`http://你的电脑IP:8888`

4. **检查后端服务**
   - 确认后端正在运行
   - 确认端口8888可访问

5. **重新构建**
   ```bash
   flutter clean
   flutter pub get
   flutter build apk --debug
   ```

## 💡 建议

1. **先在模拟器上测试** - 更容易调试
2. **查看日志** - 日志会告诉你具体错误
3. **逐步测试** - 找出具体哪个功能导致闪退
4. **使用生产环境地址** - 如果本地连接有问题


