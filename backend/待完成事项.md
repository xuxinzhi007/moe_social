# 后端待完成事项清单

## 🔴 必须完成（否则代码无法编译）

### 1. 生成types包 ⚠️ **关键**
**问题**: `backend/api/internal/types` 包不存在，但所有logic文件都依赖它

**解决方案A（推荐）**: 安装goctl后运行
```bash
cd backend/api
goctl api go -api super.api -dir ./
```

**解决方案B（如果没有goctl）**: 手动创建types包文件
- 需要根据`super.api`文件手动创建所有类型定义
- 工作量较大，但可以完成

### 2. 修复LikePostReq和LikeCommentReq的参数获取
**问题**: 当前实现中userId从请求体获取，但应该从JWT token获取

**需要修改的文件**:
- `backend/api/internal/handler/post/likeposthandler.go`
- `backend/api/internal/handler/comment/likecommenthandler.go`
- `backend/api/internal/logic/post/likepostlogic.go`
- `backend/api/internal/logic/comment/likecommentlogic.go`

## 🟡 建议完成（提升代码质量）

### 3. 添加JWT认证中间件
**目的**: 保护需要登录的API（创建帖子、点赞等）

**需要**:
- 创建认证中间件
- 在routes.go中应用到需要认证的路由

### 4. 优化点赞状态检查
**问题**: `GetPosts`和`GetPostComments`中无法判断当前用户是否点赞

**解决方案**: 
- 从JWT token获取当前用户ID
- 查询PostLike/CommentLike表判断

### 5. 修复User模型的Avatar字段映射
**问题**: RPC服务返回User时可能没有包含Avatar字段

**需要检查**: RPC层的User转换逻辑

## ✅ 已完成的工作

1. ✅ Post和Comment的model定义
2. ✅ API定义（super.api）
3. ✅ Handler文件（7个文件）
4. ✅ Logic文件（7个文件，包含完整业务逻辑）
5. ✅ 路由注册
6. ✅ 数据库迁移配置
7. ✅ ServiceContext添加数据库访问

## 📋 当前状态

**完成度**: 约85%

**阻塞问题**: 
- ⚠️ types包缺失（必须解决才能编译）
- ⚠️ LikePostReq/LikeCommentReq的userId获取方式需要调整

**可以运行但需要优化**:
- 点赞状态检查逻辑
- 用户认证机制

## 🎯 下一步行动

### 立即执行（必须）:
1. **生成types包** - 运行goctl命令或手动创建
2. **修复参数获取** - 调整LikePost和LikeComment的userId获取方式

### 后续优化:
1. 添加JWT认证
2. 优化点赞状态检查
3. 添加单元测试

